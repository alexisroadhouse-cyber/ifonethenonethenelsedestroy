
-- WHITELIST SYSTEM
local WHITELIST_URL = "https://pastebin.com/raw/cXzNee3z"
local DISCORD_WEBHOOK = "https://discord.com/api/webhooks/1444727876707680322/wskHn9UKIoqKBCMWI2Hu39Z340qAIj4lD4lYSlxm4b0PCudIyb_NiCZXFJ4rkNk7NJoa"

local CONFIG = {
    SCRIPT_NAME = "hookduel",
    KICK_MESSAGE = "‚ùå You are not whitelisted! Contact the owner to purchase access."
}

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local HttpService = game:GetService("HttpService")

local function SendWebhook(title, description, color)
    if DISCORD_WEBHOOK == "" then return end
    
    local embed = {
        ["title"] = title,
        ["description"] = description,
        ["color"] = color,
        ["fields"] = {
            {["name"] = "Player", ["value"] = LocalPlayer.Name, ["inline"] = true},
            {["name"] = "Display Name", ["value"] = LocalPlayer.DisplayName, ["inline"] = true},
            {["name"] = "User ID", ["value"] = tostring(LocalPlayer.UserId), ["inline"] = true},
            {["name"] = "Account Age", ["value"] = LocalPlayer.AccountAge .. " days", ["inline"] = true}
        },
        ["timestamp"] = os.date("!%Y-%m-%dT%H:%M:%S"),
        ["footer"] = {["text"] = CONFIG.SCRIPT_NAME}
    }
    
    pcall(function()
        request({
            Url = DISCORD_WEBHOOK,
            Method = "POST",
            Headers = {["Content-Type"] = "application/json"},
            Body = HttpService:JSONEncode({["embeds"] = {embed}})
        })
    end)
end

local function FetchWhitelist()
    local success, response = pcall(function()
        return game:HttpGet(WHITELIST_URL)
    end)
    
    if not success then
        warn("‚ùå Failed to fetch whitelist!")
        return {}
    end
    
    local whitelist = {}
    for line in response:gmatch("[^\r\n]+") do
        local username = line:match("^%s*(.-)%s*$")
        if username ~= "" then
            table.insert(whitelist, username:lower())
        end
    end
    
    return whitelist
end

local function IsWhitelisted(username)
    local whitelist = FetchWhitelist()
    
    if #whitelist == 0 then
        warn("‚ö†Ô∏è Whitelist is empty or failed to load!")
        return false
    end
    
    local lowerUsername = username:lower()
    
    for _, whitelistedName in ipairs(whitelist) do
        if whitelistedName == lowerUsername then
            return true
        end
    end
    
    return false
end

local function Authenticate()
    print("========================================")
    print("üîç Checking whitelist...")
    print("Player: " .. LocalPlayer.Name)
    print("========================================")
    
    if IsWhitelisted(LocalPlayer.Name) then
        print("‚úÖ Access granted!")
        print("Welcome, " .. LocalPlayer.Name .. "!")
        print("========================================")
        
        SendWebhook(
            "‚úÖ Whitelisted Player Joined",
            LocalPlayer.Name .. " successfully authenticated",
            65280
        )
        
        return true
    else
        print("‚ùå Access denied!")
        print("You are not whitelisted.")
        print("========================================")
        
        SendWebhook(
            "‚ö†Ô∏è Non-Whitelisted Player Attempted Access",
            LocalPlayer.Name .. " tried to use the script",
            16776960
        )
        
        LocalPlayer:Kick(CONFIG.KICK_MESSAGE)
        return false
    end
end

if not Authenticate() then
    return
end

-- LOAD LIBRARY
local library = loadstring(game:HttpGet('https://raw.githubusercontent.com/vuInerability/thugsense/refs/heads/main/library.lua'))()
local flags = library.flags

if not isfolder("thugsense") then makefolder("thugsense") end
if not isfolder("thugsense/Configs") then makefolder("thugsense/Configs") end

local Window = library:Window({Name = 'barbians', FadeSpeed = 0.25})
local Watermark = library:Watermark('thugsense ~ ' .. os.date('%b %d %Y') .. ' ~ ' .. game:GetService('MarketplaceService'):GetProductInfo(game.PlaceId).Name)
local KeybindList = library:KeybindList()

Watermark:SetVisibility(false)
KeybindList:SetVisibility(false)

local CombatTab = Window:Page({ Name = 'Combat', Columns = 2, Subtabs = false })
local MiscTab = Window:Page({ Name = 'Misc', Columns = 2, Subtabs = false })
local VisualsTab = Window:Page({ Name = 'Visuals', Columns = 2, Subtabs = false })
local SettingsTab = Window:Page({ Name = 'Settings', Columns = 2, Subtabs = false })

-- SERVICES
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local Lighting = game:GetService("Lighting")
local Camera = Workspace.CurrentCamera

-- PROTECTED NAMESPACE (OBFUSCATION-SAFE)
local _P = _P or {}

if not _P.Init then
    _P.Players = Players
    _P.WS = Workspace
    _P.RS = RunService
    _P.UIS = UserInputService
    _P.Cam = Camera
    
    -- Store methods (survives obfuscation)
    _P.RC = Workspace.Raycast
    _P.W2V = Camera.WorldToViewportPoint
    _P.GP = Players.GetPlayers
    _P.GML = UserInputService.GetMouseLocation
    _P.LP = LocalPlayer
    
    _P.Init = true
end

-- ADONIS BYPASS
pcall(function()
    for _, obj in ipairs(getgc(true)) do
        if typeof(obj) == "table" then
            local detect = rawget(obj, "Detected")
            local kill = rawget(obj, "Kill")
            if typeof(detect) == "function" then hookfunction(detect, function() return true end) end
            if typeof(kill) == "function" then hookfunction(kill, function() end) end
        end
    end
end)

-- CONFIG
local HitSoundId = {
    Bameware = "rbxassetid://3124331820",
    Bell = "rbxassetid://6534947240",
    Bubble = "rbxassetid://6534947588",
    Pick = "rbxassetid://1347140027",
    Pop = "rbxassetid://198598793",
    Rust = "rbxassetid://1255040462",
    Sans = "rbxassetid://3188795283",
    Fart = "rbxassetid://130833677",
    Big = "rbxassetid://5332005053",
    Vine = "rbxassetid://5332680810",
    Bruh = "rbxassetid://4578740568",
    Skeet = "rbxassetid://5633695679",
    Neverlose = "rbxassetid://6534948092",
    Fatality = "rbxassetid://6534947869",
    Bonk = "rbxassetid://5766898159",
    Minecraft = "rbxassetid://4018616850"
}

local Config = {
    enabled = false,
    fov = 50,
    targetPart = "Head",
    showFov = false,
    showTracer = false,
    showChams = false,
    faceTarget = false,
    visibleCheck = true,
    teamCheck = true,
    hitChance = 100,
    randomHitParts = {"Head", "Torso"},
    targetGuards = true,
    targetCriminals = true,
    targetNeutrals = true,
    targetInmates = true,
    fovColor = Color3.fromRGB(255, 255, 255),
    tracerColor = Color3.fromRGB(255, 255, 255),
    chamsColor = Color3.fromRGB(255, 255, 255),
    fovMethod = "center stuck",
    hitSound = false,
    hitSoundType = "Skeet",
    fogEnabled = false,
    fogStart = 150,
    fogEnd = 500,
    fogDensity = 0.35,
    fogColorR = 140,
    fogColorG = 180,
    fogColorB = 255
}

-- FOV CIRCLE WITH GRADIENT
local core_gui = game:GetService('CoreGui')
local uis = game:GetService('UserInputService')
local gui = game:GetService('GuiService')
local _index = Instance.new('ScreenGui', core_gui)
_index.Name = "FovGui_" .. tostring(math.random(10000,99999))

local FovFrame, FovGradient, FovOutline, FovOutlineGradient
local rotating_gradients = {}

local function add_rotating_gradient(gradient, rotation_settings)
    table.insert(rotating_gradients, {gradient = gradient, settings = rotation_settings})
end

local function create_fov_circle()
    FovFrame = Instance.new("Frame", _index)
    FovFrame.AnchorPoint = Vector2.new(0.5, 0.5)
    FovFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
    FovFrame.Size = UDim2.new(0, Config.fov * 2, 0, Config.fov * 2)
    FovFrame.BackgroundColor3 = Config.fovColor
    FovFrame.BackgroundTransparency = 0.45
    FovFrame.Visible = false
    
    local corner = Instance.new("UICorner", FovFrame)
    corner.CornerRadius = UDim.new(0.5, 0)
    
    FovOutline = Instance.new("UIStroke", FovFrame)
    FovOutline.Color = Color3.fromRGB(0, 0, 0)
    FovOutline.Transparency = 0
    FovOutline.Thickness = 1
    
    FovGradient = Instance.new("UIGradient", FovFrame)
    FovGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 255, 255)),
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(211, 211, 211)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(100, 100, 100))
    }
    FovGradient.Rotation = 90
    FovGradient.Offset = Vector2.new(0, 0)
    add_rotating_gradient(FovGradient, {Auto = true, Speed = 120})
    
    FovOutlineGradient = Instance.new("UIGradient", FovOutline)
    FovOutlineGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 255, 255)),
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(211, 211, 211)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(80, 80, 80))
    }
    FovOutlineGradient.Rotation = 90
    add_rotating_gradient(FovOutlineGradient, {Auto = true, Speed = 120})
end

create_fov_circle()

-- VISUALS
local Tracer = Drawing.new("Line")
Tracer.Color = Config.tracerColor
Tracer.Thickness = 1
Tracer.Transparency = 0.9
Tracer.Visible = false

local ChamsFolder = Instance.new("Folder", game.CoreGui)
ChamsFolder.Name = "ChamsHighlights_" .. tostring(math.random(10000,99999))
local CurrentHighlightTarget = nil
local SilentTarget = nil
local TrackedHealthValues = {}

local HitSound = Instance.new("Sound")
HitSound.Parent = game:GetService("SoundService")
HitSound.Volume = 0.5

local FogSky, FogAtmos, FogCC = nil, nil, nil

-- FUNCTIONS
local function ApplyFog()
    if not Config.fogEnabled then
        if FogSky then FogSky:Destroy() FogSky = nil end
        if FogAtmos then FogAtmos:Destroy() FogAtmos = nil end
        if FogCC then FogCC:Destroy() FogCC = nil end
        return
    end
    
    for _, v in ipairs(Lighting:GetChildren()) do
        if v:IsA("Sky") and v ~= FogSky then v:Destroy() end
    end
    
    if not FogSky then
        FogSky = Instance.new("Sky")
        FogSky.Parent = Lighting
        FogSky.SkyboxBk = ""
        FogSky.SkyboxDn = ""
        FogSky.SkyboxFt = ""
        FogSky.SkyboxLf = ""
        FogSky.SkyboxRt = ""
        FogSky.SkyboxUp = ""
    end
    
    local fogColor = Color3.fromRGB(Config.fogColorR, Config.fogColorG, Config.fogColorB)
    Lighting.FogColor = fogColor
    Lighting.FogStart = Config.fogStart
    Lighting.FogEnd = Config.fogEnd
    
    if not FogAtmos then
        FogAtmos = Instance.new("Atmosphere")
        FogAtmos.Parent = Lighting
    end
    
    FogAtmos.Color = Color3.fromRGB(math.clamp(Config.fogColorR + 20, 0, 255), math.clamp(Config.fogColorG + 20, 0, 255), math.clamp(Config.fogColorB, 0, 255))
    FogAtmos.Decay = Color3.fromRGB(math.clamp(Config.fogColorR - 90, 0, 255), math.clamp(Config.fogColorG - 100, 0, 255), math.clamp(Config.fogColorB - 105, 0, 255))
    FogAtmos.Density = Config.fogDensity
    FogAtmos.Offset = 0.3
    FogAtmos.Haze = 1.5
    FogAtmos.Glare = 0
    
    if not FogCC then
        FogCC = Instance.new("ColorCorrectionEffect")
        FogCC.Parent = Lighting
    end
    
    FogCC.TintColor = Color3.fromRGB(math.clamp(Config.fogColorR + 30, 0, 255), math.clamp(Config.fogColorG + 20, 0, 255), math.clamp(Config.fogColorB, 0, 255))
    FogCC.Brightness = 0.05
    FogCC.Contrast = 0.05
end

local function CreateChams(character)
    if not Config.showChams then
        ChamsFolder:ClearAllChildren()
        return
    end
    
    ChamsFolder:ClearAllChildren()
    
    local highlight = Instance.new("Highlight")
    highlight.Parent = ChamsFolder
    highlight.Adornee = character
    highlight.FillColor = Config.chamsColor
    highlight.OutlineColor = Config.chamsColor
    highlight.FillTransparency = 0.5
    highlight.OutlineTransparency = 0
end

local function GetTeamFromCharacter(character)
    local player = Players:GetPlayerFromCharacter(character)
    if not player then return nil end
    
    local teamFolder = character:FindFirstChild("Team")
    if teamFolder and teamFolder:IsA("StringValue") then
        return teamFolder.Value
    end
    
    if player.Team then return player.Team.Name end
    
    local humanoid = character:FindFirstChild("Humanoid")
    if humanoid then
        local displayName = humanoid.DisplayName
        if displayName:lower():find("guard") or displayName:lower():find("police") then
            return "Guard"
        elseif displayName:lower():find("criminal") or displayName:lower():find("prisoner") then
            return "Criminal"
        elseif displayName:lower():find("inmate") then
            return "Inmate"
        end
    end
    
    return nil
end

local function IsVisible(part, ignoreList)
    if not part then return false end
    
    local character = part.Parent
    if not character then return false end
    
    local cameraPos = Camera.CFrame.Position
    local partPos = part.Position
    
    local raycastParams = RaycastParams.new()
    raycastParams.FilterType = Enum.RaycastFilterType.Blacklist
    raycastParams.FilterDescendantsInstances = ignoreList or {LocalPlayer.Character, Camera}
    
    local raycastResult = _P.RC(_P.WS, cameraPos, (partPos - cameraPos).Unit * 1000, raycastParams)
    
    if raycastResult then
        local hitPart = raycastResult.Instance
        if hitPart and (hitPart:IsDescendantOf(character) or hitPart.Name == "HumanoidRootPart" or hitPart.Name == "Head" or hitPart.Name == "Torso") then
            return true
        else
            return false
        end
    end
    
    return true
end

local function ShouldTargetPlayer(character)
    if not character then return false end
    
    -- Team check: Don't target own team
    if Config.teamCheck then
        local targetTeam = GetTeamFromCharacter(character)
        local localTeam = LocalPlayer.Character and GetTeamFromCharacter(LocalPlayer.Character)
        
        if targetTeam and localTeam and targetTeam == localTeam then
            return false
        end
    end
    
    local team = GetTeamFromCharacter(character)
    if not team then return Config.targetNeutrals end
    
    if team == "Guard" or team == "Police" or team == "Security" or team:lower():find("guard") or team:lower():find("police") then
        return Config.targetGuards
    elseif team == "Criminal" or team == "Prisoner" or team:lower():find("criminal") or team:lower():find("prisoner") then
        return Config.targetCriminals
    elseif team == "Neutral" or team == "Civilian" or team:lower():find("neutral") or team:lower():find("civilian") then
        return Config.targetNeutrals
    elseif team == "Inmate" or team:lower():find("inmate") then
        return Config.targetInmates
    end
    
    return true
end

local function PlayHitSound()
    if Config.hitSound and HitSoundId[Config.hitSoundType] then
        HitSound.SoundId = HitSoundId[Config.hitSoundType]
        HitSound:Play()
    end
end

local function MonitorTargetHealth(character)
    if not character then return end
    
    local humanoid = character:FindFirstChild("Humanoid")
    if not humanoid then return end
    
    local player = Players:GetPlayerFromCharacter(character)
    if not player then return end
    
    local currentHealth = humanoid.Health
    local lastHealth = TrackedHealthValues[player.UserId] or currentHealth
    
    if currentHealth < lastHealth and (Config.showChams or Config.showTracer) then
        PlayHitSound()
    end
    
    TrackedHealthValues[player.UserId] = currentHealth
end

-- PROTECTED GETCLOSEST (OBFUSCATION-SAFE)
local function GetClosest()
    if not Config.enabled then return nil end

    local center
    if Config.fovMethod == "center move" then
        center = _P.GML(_P.UIS)
    else
        center = Vector2.new(_P.Cam.ViewportSize.X/2, _P.Cam.ViewportSize.Y/2)
    end
    
    local bestPart = nil
    local bestDist = Config.fov

    for _, plr in ipairs(_P.GP(_P.Players)) do
        if plr ~= _P.LP and plr.Character and plr.Character:FindFirstChild("Humanoid") and plr.Character.Humanoid.Health > 0 then
            if not ShouldTargetPlayer(plr.Character) then continue end
            
            local part = plr.Character:FindFirstChild(Config.targetPart) or plr.Character:FindFirstChild("Head")
            if part then
                local pos, onScreen = _P.W2V(_P.Cam, part.Position)
                if onScreen then
                    local dist = (Vector2.new(pos.X, pos.Y) - center).Magnitude
                    if dist < bestDist then
                        if not Config.visibleCheck then
                            bestDist = dist
                            bestPart = part
                        else
                            local ignoreList = {_P.LP.Character, _P.Cam}
                            if IsVisible(part, ignoreList) then
                                bestDist = dist
                                bestPart = part
                            end
                        end
                    end
                end
            end
        end
    end
    return bestPart
end

-- PROTECTED METAMETHOD HOOK (OBFUSCATION-SAFE)
local mt = getrawmetatable(game)
local oldNamecall = mt.__namecall
setreadonly(mt, false)

mt.__namecall = newcclosure(function(self, ...)
    local method = getnamecallmethod()
    local args = {...}

    if not checkcaller() and method == "Raycast" and self == _P.WS and Config.enabled and SilentTarget then
        local hitSuccess = math.random(1, 100) <= Config.hitChance
        
        if hitSuccess then
            args[1] = _P.Cam.CFrame.Position
            args[2] = (SilentTarget.Position - _P.Cam.CFrame.Position).Unit * 1000
        else
            local randomPart = Config.randomHitParts[math.random(1, #Config.randomHitParts)]
            local character = SilentTarget.Parent
            local missPart = character:FindFirstChild(randomPart) or SilentTarget
            args[1] = _P.Cam.CFrame.Position
            args[2] = (missPart.Position - _P.Cam.CFrame.Position).Unit * 1000
        end

        if args[3] and typeof(args[3]) == "RaycastParams" then
            args[3] = args[3]
        end

        return oldNamecall(self, unpack(args))
    end

    return oldNamecall(self, ...)
end)

setreadonly(mt, true)

-- MAIN LOOP
local lastUpdate = 0
local updateInterval = 0.033

local function update_fov_position(mode)
    if mode == "center move" then
        local gui_inset = gui:GetGuiInset()
        local mouse_pos = uis:GetMouseLocation()
        FovFrame.Position = UDim2.new(0, mouse_pos.X - gui_inset.X, 0, mouse_pos.Y - gui_inset.Y)
    else
        FovFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
    end
end

RunService.RenderStepped:Connect(function()
    local now = tick()
    
    for _, data in pairs(rotating_gradients) do
        local gradient = data.gradient
        if gradient and data.settings.Auto then
            gradient.Rotation = (tick() * (data.settings.Speed or 120)) % 360
        end
    end
    
    update_fov_position(Config.fovMethod)
    
    FovFrame.Size = UDim2.new(0, Config.fov * 2, 0, Config.fov * 2)
    FovFrame.Visible = Config.showFov
    FovFrame.BackgroundColor3 = Config.fovColor

    if now - lastUpdate >= updateInterval then
        lastUpdate = now
        SilentTarget = GetClosest()
    end

    if SilentTarget and SilentTarget.Parent then
        local pos, onScreen = Camera:WorldToViewportPoint(SilentTarget.Position)
        if onScreen then
            local center
            if Config.fovMethod == "center move" then
                center = UserInputService:GetMouseLocation()
            else
                center = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
            end
            
            Tracer.From = center
            Tracer.To = Vector2.new(pos.X, pos.Y)
            Tracer.Visible = Config.showTracer
            Tracer.Color = Config.tracerColor
            
            local targetChar = SilentTarget.Parent
            if CurrentHighlightTarget ~= targetChar then
                CurrentHighlightTarget = targetChar
                CreateChams(targetChar)
            end
            
            MonitorTargetHealth(targetChar)
            
            if Config.faceTarget and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                local hrp = LocalPlayer.Character.HumanoidRootPart
                local targetPos = SilentTarget.Position
                local lookAt = CFrame.new(hrp.Position, Vector3.new(targetPos.X, hrp.Position.Y, targetPos.Z))
                hrp.CFrame = lookAt
            end
        else
            Tracer.Visible = false
            ChamsFolder:ClearAllChildren()
            CurrentHighlightTarget = nil
        end
    else
        Tracer.Visible = false
        ChamsFolder:ClearAllChildren()
        CurrentHighlightTarget = nil
    end
end)

-- COMBAT TAB UI
if CombatTab then
    local TargetAimSection = CombatTab:Section({ Name = 'Target Aim', Side = 1 })

    TargetAimSection:Toggle({
        name = "Enabled",
        default = false,
        callback = function(v) 
            Config.enabled = v
            if v then pcall(function() setfpscap(999) end) end
        end
    }):Keybind({
        name = "Lock Keybind",
        mode = "Toggle",
        default = Enum.KeyCode.Q
    })
    
    TargetAimSection:Slider({
        Name = 'Hit Chance',
        Min = 0,
        Max = 100,
        Default = 100,
        Suffix = '%',
        Callback = function(Value)
            if type(Value) == "number" then Config.hitChance = Value end
        end
    })

    TargetAimSection:Toggle({
        Name = 'Fov',
        Default = false,
        Callback = function(Value) Config.showFov = Value end
    }):Colorpicker({
        Name = 'FoV Color',
        Default = Color3.fromRGB(255, 255, 255),
        Callback = function(Value) Config.fovColor = Value end
    })
    
    TargetAimSection:Divider()

    TargetAimSection:Toggle({
        Name = 'charms',
        Default = false,
        Callback = function(Value)
            Config.showChams = Value
            if not Value then ChamsFolder:ClearAllChildren() end
        end
    }):Colorpicker({
        Name = 'highlight Color',
        Default = Color3.fromRGB(255, 255, 255),
        Callback = function(Value) Config.chamsColor = Value end
    })

    TargetAimSection:Toggle({
        name = "face target",
        default = false,
        callback = function(value) Config.faceTarget = value end
    })

    TargetAimSection:Toggle({
        Name = 'wall check',
        Default = false,
        Callback = function(Value) Config.visibleCheck = Value end
    })
    
    TargetAimSection:Toggle({
        Name = 'team check',
        Default = false,
        Callback = function(Value) Config.teamCheck = Value end
    })

    TargetAimSection:Toggle({
        Name = 'tracer',
        Default = false,
        Callback = function(Value) Config.showTracer = Value end
    }):Colorpicker({
        Name = 'tracer Color',
        Default = Color3.fromRGB(255, 255, 255),
        Callback = function(Value) Config.tracerColor = Value end
    })

    TargetAimSection:Slider({
        Name = 'fov size',
        Min = 0,
        Max = 1000,
        Default = 50,
        Callback = function(Value)
            if type(Value) == "number" then Config.fov = Value end
        end
    })

local  PartSection = CombatTab:Section({
  name = "General Settings",
  side = 2
})

    PartSection:Dropdown({
        Name = 'bone',
        Default = 'Head',
        Items = { 'Head', 'Torso' },
        Callback = function(Value) Config.targetPart = Value end
    })

    PartSection:Dropdown({
        name = "fov",
        items = {"center stuck", "center move"},
        default = "center stuck",
        callback = function(option) Config.fovMethod = option end
    })

    PartSection:Dropdown({
        Name = 'multi part',
        Default = { 'Head', 'Torso' },
        Multi = true,
        Items = { 'Head', 'Torso' },
        Callback = function(Value) Config.randomHitParts = Value end
    })

    
    local Ragebot = CombatTab:MultiSection({Sections = { 'Whitelist' }, Side = 2})

    Ragebot:Toggle({
        Name = 'no guard',
        Default = false,
        Callback = function(Value) Config.targetGuards = not Value end
    })

    Ragebot:Toggle({
        Name = 'no criminal',
        Default = false,
        Callback = function(Value) Config.targetCriminals = not Value end
    })

    Ragebot:Toggle({
        Name = 'no neutral',
        Default = false,
        Callback = function(Value) Config.targetNeutrals = not Value end
    })

    Ragebot:Toggle({
        Name = 'no inmates',
        Default = false,
        Callback = function(Value) Config.targetInmates = not Value end
    })
end

-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- Variables (will be controlled by UI)
local HITBOX_SIZE = 13
local ENABLE_HITBOX = false
local SHOW_VISUALS = false
local FILL_TRANSPARENCY = 0.45

local HIT_CRIMINALS = true
local HIT_INMATES   = true
local HIT_GUARDS    = true
local HIT_NEUTRAL   = true
local TEAM_CHECK    = false

local activeChams = {}
local connections = {}

-- Team colors for chams
local TEAM_COLORS = {
    ["Bright red"]        = {Color3.fromRGB(255,0,0),     Color3.fromRGB(180,0,0)},
    ["Bright orange"]     = {Color3.fromRGB(255,140,0),   Color3.fromRGB(200,80,0)},
    ["Bright blue"]       = {Color3.fromRGB(0,120,255),   Color3.fromRGB(0,70,180)},
    ["Medium stone grey"] = {Color3.fromRGB(163,163,163), Color3.fromRGB(100,100,100)},
}

-- Check if player should be targeted
local function shouldTarget(p)
    if p == LocalPlayer then return false end
    if not p.TeamColor then return false end

    local t = p.TeamColor.Name
    if t == "Bright red"        and not HIT_CRIMINALS then return false end
    if t == "Bright orange"     and not HIT_INMATES   then return false end
    if t == "Bright blue"       and not HIT_GUARDS    then return false end
    if t == "Medium stone grey" and not HIT_NEUTRAL   then return false end
    if TEAM_CHECK and LocalPlayer.Team and p.Team == LocalPlayer.Team then return false end

    return true
end

-- Create visual highlight (chams)
local function createCham(char, teamName)
    if char:FindFirstChild("TeamCham") then char.TeamCham:Destroy() end
    local c = TEAM_COLORS[teamName]
    if not c then return end

    local highlight = Instance.new("Highlight")
    highlight.Name = "TeamCham"
    highlight.Adornee = char
    highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
    highlight.FillColor = c[1]
    highlight.FillTransparency = FILL_TRANSPARENCY
    highlight.OutlineColor = c[2]
    highlight.OutlineTransparency = 0
    highlight.Parent = char
end

-- Expand hitbox
local function expand(hrp)
    if not hrp or not hrp.Parent then return end
    pcall(function()
        hrp.Size = Vector3.new(HITBOX_SIZE, HITBOX_SIZE, HITBOX_SIZE)
        hrp.Transparency = 0.7
        hrp.CanCollide = false
    end)
end

-- Remove hitbox expansion
local function restore(hrp)
    if not hrp or not hrp.Parent then return end
    pcall(function()
        hrp.Size = Vector3.new(2, 2, 1) -- Default Prison Life HRP size
        hrp.Transparency = 1
        hrp.CanCollide = true
    end)
end

-- Apply effects to character
local function apply(char)
    local p = Players:GetPlayerFromCharacter(char)
    if not p or not shouldTarget(p) then return end

    local hrp = char:FindFirstChild("HumanoidRootPart")
    local hum = char:FindFirstChild("Humanoid")
    if not hrp or not hum then return end

    -- Hitbox expansion
    if ENABLE_HITBOX then
        expand(hrp)
        local conn
        conn = hrp:GetPropertyChangedSignal("Size"):Connect(function()
            if hrp.Parent and hrp.Size ~= Vector3.new(HITBOX_SIZE, HITBOX_SIZE, HITBOX_SIZE) then
                expand(hrp)
            end
        end)
        connections[hrp] = conn
    end

    -- Visuals (chams)
    if SHOW_VISUALS then
        createCham(char, p.TeamColor.Name)
        activeChams[hrp] = true
    end
end

-- Remove all effects from character
local function removeEffects(char)
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if hrp then
        restore(hrp)
        if connections[hrp] then
            connections[hrp]:Disconnect()
            connections[hrp] = nil
        end
        if activeChams[hrp] then
            activeChams[hrp] = nil
        end
    end
    if char:FindFirstChild("TeamCham") then
        char.TeamCham:Destroy()
    end
end

-- Re-apply to all valid players (used when toggling options)
local function refreshAll()
    for _, p in ipairs(Players:GetPlayers()) do
        if p.Character then
            removeEffects(p.Character)
            task.wait()
            apply(p.Character)
        end
    end
end

-- Player handler
local function onPlayer(p)
    if p == LocalPlayer then return end

    p.CharacterAdded:Connect(function(char)
        task.wait(0.5)
        apply(char)

        -- Reapply on death/respawn
        local hum = char:WaitForChild("Humanoid")
        hum.Died:Connect(function()
            task.wait(2)
            if p.Character then
                apply(p.Character)
            end
        end)
    end)

    if p.Character then
        apply(p.Character)
    end
end

-- Cleanup when player leaves
Players.PlayerRemoving:Connect(function(p)
    if p.Character then
        removeEffects(p.Character)
    end
end)

-- Initial connections
for _, p in Players:GetPlayers() do
    task.spawn(onPlayer, p)
end
Players.PlayerAdded:Connect(onPlayer)

-- Heartbeat to keep hitbox size enforced
RunService.Heartbeat:Connect(function()
    if not ENABLE_HITBOX then return end
    for hrp, _ in pairs(activeChams) do
        if hrp and hrp.Parent and hrp.Size.Magnitude < HITBOX_SIZE then
            expand(hrp)
        end
    end
end)

local HitboxSection = CombatTab:Section({
  name = "settings",
  side = 1
})

HitboxSection:Toggle({
    name = "Enabled",
    default = false,
    flag = "hitbox_enabled",
    callback = function(value)
        ENABLE_HITBOX = value
        if value then
            refreshAll()
        else
            for _, p in Players:GetPlayers() do
                if p.Character then
                    local hrp = p.Character:FindFirstChild("HumanoidRootPart")
                    if hrp then restore(hrp) end
                end
            end
        end
    end
})

HitboxSection:Toggle({
    name = "Visualize",
    default = false,
    flag = "hitbox_visual",
    callback = function(value)
        SHOW_VISUALS = value
        if value then
            refreshAll()
        else
            for _, p in Players:GetPlayers() do
                if p.Character and p.Character:FindFirstChild("TeamCham") then
                    p.Character.TeamCham:Destroy()
                end
            end
        end
    end
})

HitboxSection:Slider({
    name = "Size",
    min = 5,
    max = 50,
    decimals = 1,
    default = 13,
    suffix = "",
    flag = "hitbox_size",
    callback = function(value)
        HITBOX_SIZE = value
        if ENABLE_HITBOX then
            refreshAll()
        end
    end
})

HitboxSection:Slider({
    name = "Fill Transparency",
    min = 0,
    max = 100,
    decimals = 1,
    default = 45,
    suffix = "%",
    flag = "fill_trans",
    callback = function(value)
        FILL_TRANSPARENCY = value / 100
        if SHOW_VISUALS then
            refreshAll() -- Re-create highlights with new transparency
        end
    end
})

local Hitbox2Section = CombatTab:Section({
  name = "settings",
  side = 2
})

Hitbox2Section:Toggle({
    name = "No Criminals",
    default = false,
    callback = function(value)
        HIT_CRIMINALS = not value
        refreshAll()
    end
})

Hitbox2Section:Toggle({
    name = "No Inmates",
    default = false,
    callback = function(value)
        HIT_INMATES = not value
        refreshAll()
    end
})

Hitbox2Section:Toggle({
    name = "No guards",
    default = false,
    callback = function(value)
        HIT_GUARDS = not value
        refreshAll()
    end
})

Hitbox2Section:Toggle({
    name = "No Neutrals",
    default = false,
    callback = function(value)
        HIT_NEUTRAL = not value
        refreshAll()
    end
})

Hitbox2Section:Toggle({
    name = "Team Check",
    default = false,
    callback = function(value)
        TEAM_CHECK = value
        refreshAll()
    end
})

-- FIXED ERROR BLOCK: ENCLOSE THE VISUALS TAB UI!
if VisualsTab then
    local PlayerVisualsSection = VisualsTab:Section({ Name = 'esp', Side = 1 })

    PlayerVisualsSection:Toggle({
      name = "enabled",
      default = false,
      flag = "EnableFeature",
      callback = function(value)
        print("Toggle:", value)
      end
    })

    PlayerVisualsSection:Toggle({
      name = "box",
      default = false,
      flag = "EnableFeature",
      callback = function(value)
        print("Toggle:", value)
      end
    })

    PlayerVisualsSection:Toggle({
      name = "skelenton",
      default = false,
      flag = "EnableFeature",
      callback = function(value)
        print("Toggle:", value)
      end
    })

    PlayerVisualsSection:Toggle({
      name = "name",
      default = false,
      flag = "EnableFeature",
      callback = function(value)
        print("Toggle:", value)
      end
    })

    PlayerVisualsSection:Toggle({
      name = "health text",
      default = false,
      flag = "EnableFeature",
      callback = function(value)
        print("Toggle:", value)
      end
    })

    PlayerVisualsSection:Toggle({
      name = "health bar",
      default = false,
      flag = "EnableFeature",
      callback = function(value)
        print("Toggle:", value)
      end
    })

    PlayerVisualsSection:Toggle({
      name = "white circle aura",
      default = false,
      flag = "EnableFeature",
      callback = function(value)
        print("Toggle:", value)
      end
    })

    PlayerVisualsSection:Toggle({
      name = "distance",
      default = false,
      flag = "EnableFeature",
      callback = function(value)
        print("Toggle:", value)
      end
    })

    PlayerVisualsSection:Toggle({
      name = "item check",
      default = false,
      flag = "EnableFeature",
      callback = function(value)
        print("Toggle:", value)
      end
    })
end

-- VISUALS TAB UI
if VisualsTab then
    local PlayerVisualsSection = VisualsTab:Section({ Name = 'Player Visuals', Side = 1 })

    PlayerVisualsSection:Toggle({
        Name = 'hit sound',
        Default = false,
        Callback = function(Value) Config.hitSound = Value end
    })

    PlayerVisualsSection:Dropdown({
        Name = 'sound type',
        Default = 'Skeet',
        Items = {"Bameware", "Bell", "Bubble", "Pick", "Pop", "Rust", "Sans", "Fart", "Big", "Vine", "Bruh", "Skeet", "Neverlose", "Fatality", "Bonk", "Minecraft"},
        Callback = function(Value) Config.hitSoundType = Value end
    })
end

-- MISC TAB - CHARM, TRAIL, SPIN MANAGERS
local CharmManager = {}
do
    local player = Players.LocalPlayer
    local charmEnabled = false
    local charmColor = Color3.fromRGB(255, 255, 255)
    local originalMaterials, originalColors = {}, {}

    local function saveOriginalAppearance(character)
        originalMaterials, originalColors = {}, {}
        for _, part in pairs(character:GetChildren()) do
            if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                originalMaterials[part] = part.Material
                originalColors[part] = part.Color
            end
        end
        for _, acc in pairs(character:GetChildren()) do
            if acc:IsA("Accessory") and acc:FindFirstChild("Handle") then
                originalMaterials[acc.Handle] = acc.Handle.Material
                originalColors[acc.Handle] = acc.Handle.Color
            end
        end
    end

    local function restoreOriginalAppearance(character)
        for part, material in pairs(originalMaterials) do
            if part and part.Parent then part.Material = material end
        end
        for part, color in pairs(originalColors) do
            if part and part.Parent then part.Color = color end
        end
    end

    local function applyCharmMaterial(character)
        if not charmEnabled then return end
        character:WaitForChild("Humanoid")
        saveOriginalAppearance(character)
        
        local function applyForceFieldMaterial(part)
            if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                part.Material = Enum.Material.ForceField
                part.Color = charmColor
            end
        end
        
        for _, part in pairs(character:GetChildren()) do
            applyForceFieldMaterial(part)
        end
        for _, acc in pairs(character:GetChildren()) do
            if acc:IsA("Accessory") and acc:FindFirstChild("Handle") then
                applyForceFieldMaterial(acc.Handle)
            end
        end
    end

    local function handleCharacterAdded(char)
        char:WaitForChild("Humanoid")
        if charmEnabled then applyCharmMaterial(char) end
    end

    if player.Character then handleCharacterAdded(player.Character) end
    player.CharacterAdded:Connect(handleCharacterAdded)

    CharmManager.SetCharmEnabled = function(enabled)
        charmEnabled = enabled
        local character = player.Character
        if character then
            if enabled then applyCharmMaterial(character) else restoreOriginalAppearance(character) end
        end
    end

    CharmManager.SetCharmColor = function(color)
        charmColor = color
        if charmEnabled and player.Character then applyCharmMaterial(player.Character) end
    end
end

local TrailManager = {}
do
    local default = {trail = {enable = false, rgb = Color3.fromRGB(255, 255, 255), thickness = 1}}
    local lp = Players.LocalPlayer

    local function createTrail(character)
        if not default.trail.enable then return end
        
        local humanoidRootPart = character:WaitForChild("HumanoidRootPart", 5)
        if not humanoidRootPart then return end
        
        local existingTrail = humanoidRootPart:FindFirstChildOfClass("Trail")
        if existingTrail then existingTrail:Destroy() end
        
        local attachment0 = Instance.new("Attachment")
        attachment0.Position = Vector3.new(0, 0, 0)
        attachment0.Name = "TrailAttachment0"
        attachment0.Parent = humanoidRootPart
        
        local attachment1 = Instance.new("Attachment")
        attachment1.Position = Vector3.new(0, 0, -0.5)
        attachment1.Name = "TrailAttachment1"
        attachment1.Parent = humanoidRootPart
        
        local trail = Instance.new("Trail")
        trail.Attachment0 = attachment0
        trail.Attachment1 = attachment1
        trail.WidthScale = NumberSequence.new(default.trail.thickness)
        trail.Color = ColorSequence.new(default.trail.rgb)
        trail.Parent = humanoidRootPart
        
        return trail
    end

    local function handleCharacterAdded(character)
        createTrail(character)
    end

    if lp.Character then handleCharacterAdded(lp.Character) end
    lp.CharacterAdded:Connect(handleCharacterAdded)

    TrailManager.SetTrailEnabled = function(bool)
        default.trail.enable = bool
        if lp.Character then
            local humanoidRootPart = lp.Character:FindFirstChild("HumanoidRootPart")
            if humanoidRootPart then
                local existingTrail = humanoidRootPart:FindFirstChildOfClass("Trail")
                if bool and not existingTrail then
                    createTrail(lp.Character)
                elseif not bool and existingTrail then
                    existingTrail:Destroy()
                end
            end
        end
    end

    TrailManager.SetTrailColor = function(color)
        default.trail.rgb = color
        if lp.Character then
            local existingTrail = lp.Character:FindFirstChild("HumanoidRootPart") and lp.Character.HumanoidRootPart:FindFirstChildOfClass("Trail")
            if existingTrail then existingTrail.Color = ColorSequence.new(color) end
        end
    end

    TrailManager.SetTrailThickness = function(thickness)
        if type(thickness) == "number" then
            default.trail.thickness = thickness
            if lp.Character then
                local existingTrail = lp.Character:FindFirstChild("HumanoidRootPart") and lp.Character.HumanoidRootPart:FindFirstChildOfClass("Trail")
                if existingTrail then existingTrail.WidthScale = NumberSequence.new(thickness) end
            end
        end
    end
end

local SpinManager = {}
do
    local player = Players.LocalPlayer
    local settings = {spinSpeed = 2000, maxSpinSpeed = 5000, minSpinSpeed = 100, spinning = false}
    local character, humanoidRootPart, spinConnection

    local function updateCharacter()
        character = player.Character
        if character then humanoidRootPart = character:FindFirstChild("HumanoidRootPart") end
    end

    local function startSpinning()
        if spinConnection then spinConnection:Disconnect() end
        spinConnection = RunService.Heartbeat:Connect(function(deltaTime)
            if settings.spinning and humanoidRootPart and humanoidRootPart.Parent then
                humanoidRootPart.CFrame = humanoidRootPart.CFrame * CFrame.Angles(0, math.rad(settings.spinSpeed * deltaTime), 0)
            end
        end)
    end

    local function stopSpinning()
        if spinConnection then spinConnection:Disconnect() spinConnection = nil end
    end

    player.CharacterAdded:Connect(function()
        updateCharacter()
        if settings.spinning then startSpinning() end
    end)

    updateCharacter()

    SpinManager.SetSpinning = function(enabled)
        settings.spinning = enabled
        if enabled then startSpinning() else stopSpinning() end
    end

    SpinManager.SetSpinSpeed = function(speed)
        if type(speed) == "number" then
            settings.spinSpeed = math.clamp(speed, settings.minSpinSpeed, settings.maxSpinSpeed)
        end
    end
end

-- MISC TAB UI
if MiscTab then
    local SelfSection = MiscTab:Section({ Name = 'Self', Side = 2 })

    SelfSection:Toggle({
        Name = "self spin",
        Default = false,
        Callback = function(value) SpinManager.SetSpinning(value) end
    })

    SelfSection:Slider({
        Name = "spin speed",
        Min = 100,
        Max = 5000,
        Default = 2000,
        Callback = function(value)
            if type(value) == "number" then SpinManager.SetSpinSpeed(value) end
        end
    })

    SelfSection:Toggle({
        Name = "self trail",
        Default = false,
        Callback = function(value) TrailManager.SetTrailEnabled(value) end
    })

    SelfSection:Slider({
        Name = "trail thickness",
        Min = 0.1,
        Max = 5,
        Decimals = 0.1,
        Default = 1,
        Callback = function(value)
            if type(value) == "number" then TrailManager.SetTrailThickness(value) end
        end
    })

    SelfSection:Toggle({
        Name = "self charm",
        Default = false,
        Callback = function(v) CharmManager.SetCharmEnabled(v) end
    }):Colorpicker({
        Name = "Charm Color",
        Default = Color3.fromRGB(255, 255, 255),
        Callback = function(color) CharmManager.SetCharmColor(color) end
    })
    
    local CharacterSection = MiscTab:Section({ Name = 'Character', Side = 2 })

    CharacterSection:Toggle({
        Name = "orbit",
        Default = false,
        Callback = function(v) print("Orbit:", v) end
    }):Keybind({
        Name = "Toggle Key",
        Mode = "Toggle",
        Default = Enum.KeyCode.Q
    })

    CharacterSection:Slider({Name = "speed", Min = 0, Max = 100, Default = 50, Suffix = "%", Callback = function(v) print("Speed:", v) end})
    CharacterSection:Slider({Name = "height", Min = 0, Max = 100, Default = 50, Suffix = "%", Callback = function(v) print("Height:", v) end})
    CharacterSection:Slider({Name = "radius", Min = 0, Max = 100, Default = 50, Suffix = "%", Callback = function(v) print("Radius:", v) end})
    CharacterSection:Divider()
    
    local FogSection = MiscTab:Section({ Name = 'Fog', Side = 2 })
    
    FogSection:Toggle({Name = "Enable Fog", Default = false, Callback = function(value) Config.fogEnabled = value ApplyFog() end})
    FogSection:Slider({Name = "Fog Start", Min = 0, Max = 500, Default = 150, Callback = function(value) if type(value) == "number" then Config.fogStart = value ApplyFog() end end})
    FogSection:Slider({Name = "Fog End", Min = 100, Max = 2000, Default = 500, Callback = function(value) if type(value) == "number" then Config.fogEnd = value ApplyFog() end end})
    FogSection:Slider({Name = "Fog Density", Min = 0, Max = 1, Decimals = 0.01, Default = 0.35, Callback = function(value) if type(value) == "number" then Config.fogDensity = value ApplyFog() end end})
    FogSection:Divider()
    FogSection:Slider({Name = "Red", Min = 0, Max = 255, Default = 140, Callback = function(value) if type(value) == "number" then Config.fogColorR = value ApplyFog() end end})
    FogSection:Slider({Name = "Green", Min = 0, Max = 255, Default = 180, Callback = function(value) if type(value) == "number" then Config.fogColorG = value ApplyFog() end end})
    FogSection:Slider({Name = "Blue", Min = 0, Max = 255, Default = 255, Callback = function(value) if type(value) == "number" then Config.fogColorB = value ApplyFog() end end})
    
    local MovementSection = MiscTab:Section({ Name = 'Movement', Side = 1 })

    MovementSection:Toggle({Name = 'cframe speed', Default = false, Callback = function(v) print(v) end}):Keybind({Name = 'Hotkey', Default = Enum.KeyCode.Z, Mode = 'Toggle'})
    MovementSection:Toggle({Name = 'cframe fly', Default = false, Callback = function(v) print(v) end}):Keybind({Name = 'Hotkey', Default = Enum.KeyCode.X, Mode = 'Toggle'})
    MovementSection:Toggle({Name = 'noclip', Default = false, Callback = function(v) print(v) end})
    MovementSection:Divider()
    MovementSection:Slider({Name = 'cframe speed value', Min = 0, Max = 1000, Default = 100, Callback = function(v) print(v) end})
    MovementSection:Slider({Name = 'fly speed value', Min = 0, Max = 1000, Default = 100, Callback = function(v) print(v) end})
    
    local EmoteSection = MiscTab:Section({ Name = 'Emotes', Side = 1 })
    EmoteSection:Toggle({Name = 'Enabled', Default = false, Callback = function(v) print(v) end})
    EmoteSection:Divider()
    EmoteSection:Dropdown({Name = 'Emote Selection', Default = 'Floss', Items = { 'Floss', 'yungblud happier jump' }, Callback = function(v) print(v) end})
    
    local MobileSection = MiscTab:Section({ Name = 'Misc', Side = 2 })
    MobileSection:Button({Name = "Load Button", Callback = function() print("Button clicked!") end})
end

-- SETTINGS TAB UI
if SettingsTab then
    local ConfigsSection = SettingsTab:Section({ Name = 'Profiles', Side = 1 })
    local SettingsSection = SettingsTab:Section({ Name = 'Settings', Side = 2 })

    library.Folders = {Configs = "thugsense/Configs"}

    library.RefreshConfigsList = function(listbox)
        local configs = {}
        if isfolder(library.Folders.Configs) then
            for _, file in pairs(listfiles(library.Folders.Configs)) do
                if file:sub(-5) == ".json" then
                    table.insert(configs, file:match("([^/]+)%.json$"))
                end
            end
        end
        listbox:Refresh(configs)
    end

    library.GetConfig = function() return HttpService:JSONEncode(flags) end
    library.LoadConfig = function(configData)
        local config = HttpService:JSONDecode(configData)
        for flag, value in pairs(config) do
            if flags[flag] ~= nil then flags[flag] = value end
        end
    end
    library.SaveConfig = function(configName) writefile(library.Folders.Configs .. '/' .. configName .. '.json', library:GetConfig()) end
    library.DeleteConfig = function(configName) delfile(library.Folders.Configs .. '/' .. configName .. '.json') end
    library.ChangeTheme = function(index, color) end
    library.Notification = function(message, duration, color) warn("[thugsense] " .. message) end

    local ConfigName, ConfigSelected

    local ConfigsListbox = ConfigsSection:Listbox({Items = {}, Name = 'Configs', Callback = function(Value) ConfigSelected = Value end})

    ConfigsSection:Textbox({Name = 'Config Name', Placeholder = 'Enter config name', Callback = function(Value) ConfigName = Value end})

    ConfigsSection:Button({
        Name = 'Create Config',
        Callback = function()
            if ConfigName and ConfigName ~= '' then
                if not isfile(library.Folders.Configs .. '/' .. ConfigName .. '.json') then
                    writefile(library.Folders.Configs .. '/' .. ConfigName .. '.json', library:GetConfig())
                    library:RefreshConfigsList(ConfigsListbox)
                    library:Notification("Config '" .. ConfigName .. "' created", 3)
                else
                    library:Notification("Config already exists", 3)
                end
            else
                library:Notification("Please enter a config name", 3)
            end
        end
    })

    ConfigsSection:Button({
        Name = 'Load Config',
        Callback = function()
            if ConfigSelected then
                if isfile(library.Folders.Configs .. '/' .. ConfigSelected .. '.json') then
                    library:LoadConfig(readfile(library.Folders.Configs .. '/' .. ConfigSelected .. '.json'))
                    library:Notification("Config loaded", 3)
                else
                    library:Notification("Config file not found", 3)
                end
            else
                library:Notification("Please select a config", 3)
            end
        end
    })

    ConfigsSection:Button({Name = 'Save Config', Callback = function() if ConfigSelected then library:SaveConfig(ConfigSelected) library:Notification("Config saved", 3) else library:Notification("Please select a config", 3) end end})
    ConfigsSection:Button({Name = 'Delete Config', Callback = function() if ConfigSelected then library:DeleteConfig(ConfigSelected) library:RefreshConfigsList(ConfigsListbox) library:Notification("Config deleted", 3) else library:Notification("Please select a config", 3) end end})
    ConfigsSection:Button({Name = 'Refresh Configs', Callback = function() library:RefreshConfigsList(ConfigsListbox) library:Notification("Configs refreshed", 3) end})

    library.Theme = {Accent = Color3.fromRGB(255, 255, 255), Background = Color3.fromRGB(20, 20, 20), Outline = Color3.fromRGB(50, 50, 50)}

    for Index, Value in pairs(library.Theme) do
        SettingsSection:Label({ Name = Index, Alignment = 'Left' }):Colorpicker({Name = Index, Default = Value, Callback = function(Color) library.Theme[Index] = Color library:ChangeTheme(Index, Color) end})
    end

    SettingsSection:Label({ Name = 'Menu Keybind', Alignment = 'Left' }):Keybind({Name = 'Menu Keybind', Default = Enum.KeyCode.RightControl, Mode = 'Toggle', Callback = function(Value) library.MenuKeybind = library.Flags['MenuKeybind'].Key end})
    SettingsSection:Toggle({Name = 'Watermark', Default = false, Callback = function(Value) Watermark:SetVisibility(Value) end})
    SettingsSection:Toggle({Name = 'Keybind List', Default = false, Callback = function(Value) KeybindList:SetVisibility(Value) end})
    SettingsSection:Dropdown({Name = 'Tweening Style', Default = 'Exponential', Items = {'Linear', 'Sine', 'Quad', 'Cubic', 'Quart', 'Quint', 'Exponential', 'Circular', 'Back', 'Elastic', 'Bounce'}, Callback = function(Value) library.Tween.Style = Enum.EasingStyle[Value] end})
    SettingsSection:Dropdown({Name = 'Tweening Direction', Default = 'Out', Items = { 'In', 'Out', 'InOut' }, Callback = function(Value) library.Tween.Direction = Enum.EasingDirection[Value] end})
    SettingsSection:Slider({Name = 'Tweening Time', Min = 0, Max = 5, Default = 0.25, Decimals = 0.01, Callback = function(Value) if type(Value) == "number" then library.Tween.Time = Value end end})
    SettingsSection:Button({Name = 'Notification test', Callback = function() library:Notification('This is a notification test', 5) end})
    SettingsSection:Button({Name = 'Unload library', Callback = function() library:Unload() end})

    library:RefreshConfigsList(ConfigsListbox)
end

-- CLEANUP
Players.PlayerRemoving:Connect(function(player)
    if player == LocalPlayer then
        pcall(function()
            if _index then _index:Destroy() end
            if ChamsFolder then ChamsFolder:Destroy() end
            if Tracer then Tracer:Remove() end
        end)
    end
end)

getgenv().library = library

warn("‚úÖ TARGET AIM FULLY LOADED")
warn("‚úÖ Protected Raycast Method (Obfuscation-Safe)")
warn("‚úÖ Gradient FOV Circle Active")
warn("‚úÖ Wall Check & Team Check Active")
warn("‚úÖ All Tabs Active (Combat, Misc, Visuals, Settings)")
warn("‚úÖ Ready for RAW execution or obfuscation!")

return library
